#!/bin/sh
basedir=$(dirname "$(echo "$0" | sed -e 's,\\,/,g')")

# Function to resolve full path to Node executable
resolve_node() {
  if command -v node >/dev/null 2>&1; then
    echo "$(command -v node)"
  elif [ -x "$basedir/node" ]; then
    echo "$basedir/node"
  else
    echo "Error: Node.js executable not found. Please make sure Node.js is installed and in your PATH." >&2
    exit 1
  fi
}

# Determine the full path to the Node executable
node_path=$(resolve_node)

# Check if the Node executable is available
if [ -z "$node_path" ]; then
  echo "Error: Node.js executable not found. Please make sure Node.js is installed and in your PATH." >&2
  exit 1
fi

# Resolve the full path to the Cypress script
cypress_script="$basedir/../cypress/bin/cypress"

# Check if the Cypress script exists
if [ ! -x "$cypress_script" ]; then
  echo "Error: Cypress script not found or not executable." >&2
  exit 1
fi

# Execute the Cypress script with the resolved Node executable
exec "$node_path" "$cypress_script" "$@"
